{"paragraphs":[{"text":"%md\n# download files to local disk","user":"anonymous","dateUpdated":"2019-01-23T14:24:34+0100","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h1>download files to local disk</h1>\n</div>"}]},"apps":[],"jobName":"paragraph_1548174744812_-479852367","id":"20190121-191838_1254846145","dateCreated":"2019-01-22T17:32:24+0100","dateStarted":"2019-01-23T14:24:34+0100","dateFinished":"2019-01-23T14:24:34+0100","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:102"},{"text":"%md\n## Import","user":"anonymous","dateUpdated":"2019-01-23T08:46:14+0100","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h2>Import</h2>\n</div>"}]},"apps":[],"jobName":"paragraph_1548174744813_-1605114576","id":"20190121-192023_952318801","dateCreated":"2019-01-22T17:32:24+0100","dateStarted":"2019-01-23T08:46:15+0100","dateFinished":"2019-01-23T08:46:15+0100","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:103"},{"text":"import sys.process._\nimport java.net.URL\nimport java.io.File\nimport java.io.File\nimport java.nio.file.{Files, StandardCopyOption}\nimport java.net.HttpURLConnection \nimport org.apache.spark.sql.functions._\nimport sqlContext.implicits._\nimport org.apache.spark.input._\nimport java.util._\nimport java.io._\nimport org.apache.spark.sql.DataFrame\nimport org.apache.spark.SparkContext\nimport org.apache.spark.SparkConf\nimport org.apache.spark.rdd.PairRDDFunctions\nimport java.util.zip.ZipInputStream\nimport org.apache.spark.sql.Column\nimport scala.util.matching.Regex\nimport org.apache.spark.sql.functions.udf","user":"anonymous","dateUpdated":"2019-01-23T08:46:15+0100","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"editorHide":false,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"import sys.process._\nimport java.net.URL\nimport java.io.File\nimport java.io.File\nimport java.nio.file.{Files, StandardCopyOption}\nimport java.net.HttpURLConnection\nimport org.apache.spark.sql.functions._\nimport sqlContext.implicits._\nimport org.apache.spark.input._\nimport java.util._\nimport java.io._\nimport org.apache.spark.sql.DataFrame\nimport org.apache.spark.SparkContext\nimport org.apache.spark.SparkConf\nimport org.apache.spark.rdd.PairRDDFunctions\nimport java.util.zip.ZipInputStream\nimport org.apache.spark.sql.Column\nimport scala.util.matching.Regex\nimport org.apache.spark.sql.functions.udf\n"}]},"apps":[],"jobName":"paragraph_1548174744814_474360351","id":"20181209-161931_737140067","dateCreated":"2019-01-22T17:32:24+0100","dateStarted":"2019-01-23T08:46:15+0100","dateFinished":"2019-01-23T08:46:45+0100","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:104"},{"text":"%md \n## GLobal functions and variables","user":"anonymous","dateUpdated":"2019-01-23T14:14:06+0100","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h2>GLobal functions and variables</h2>\n</div>"}]},"apps":[],"jobName":"paragraph_1548174744814_555973518","id":"20190121-192058_691493272","dateCreated":"2019-01-22T17:32:24+0100","dateStarted":"2019-01-23T14:14:06+0100","dateFinished":"2019-01-23T14:14:06+0100","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:105"},{"text":"val dir = \"/home/thibault/Documents/Cours_local/NoSql_INF728/Projet/data/\"\nval aws = false","user":"anonymous","dateUpdated":"2019-01-23T08:46:45+0100","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"editorHide":false,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"dir: String = /home/thibault/Documents/Cours_local/NoSql_INF728/Projet/data/\naws: Boolean = false\n"}]},"apps":[],"jobName":"paragraph_1548174744815_-559436835","id":"20190121-193000_2107760313","dateCreated":"2019-01-22T17:32:24+0100","dateStarted":"2019-01-23T08:46:45+0100","dateFinished":"2019-01-23T08:46:47+0100","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:106"},{"text":"def fileDownloader(urlOfFileToDownload: String, fileName: String) = {\n    val url = new URL(urlOfFileToDownload)\n    val connection = url.openConnection().asInstanceOf[HttpURLConnection]\n    connection.setConnectTimeout(5000)\n    connection.setReadTimeout(5000)\n    connection.connect()\n\n    if (connection.getResponseCode >= 400)\n        println(\"error\")\n    else\n        url #> new File(fileName) !!\n}","user":"anonymous","dateUpdated":"2019-01-23T08:46:47+0100","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"editorHide":false,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"warning: there was one feature warning; re-run with -feature for details\nfileDownloader: (urlOfFileToDownload: String, fileName: String)Any\n"}]},"apps":[],"jobName":"paragraph_1548174744815_-1681769963","id":"20190121-191832_1617152707","dateCreated":"2019-01-22T17:32:24+0100","dateStarted":"2019-01-23T08:46:47+0100","dateFinished":"2019-01-23T08:46:48+0100","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:107"},{"text":"def download_all_files(masterfileDF: DataFrame) = {\n    val totalRow = masterfileDF.count.toInt\n    val urlRow = masterfileDF.select(\"url\").take(totalRow.toInt)\n    val n = 0\n    for(n <- 0 to totalRow -1){ \n        val URL = urlRow(n).mkString(\"\")\n        val fileName = urlRow(n).mkString(\"\").split(\"/\").last\n        val localFileName = dir + fileName\n        fileDownloader(URL,  localFileName)\n    }\n}\n","user":"anonymous","dateUpdated":"2019-01-23T08:46:48+0100","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"editorHide":false,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"download_all_files: (masterfileDF: org.apache.spark.sql.DataFrame)Unit\n"}]},"apps":[],"jobName":"paragraph_1548174744818_-1296895971","id":"20190121-193953_919395433","dateCreated":"2019-01-22T17:32:24+0100","dateStarted":"2019-01-23T08:46:48+0100","dateFinished":"2019-01-23T08:46:50+0100","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:108"},{"text":"%md ## Download masterfiles","user":"anonymous","dateUpdated":"2019-01-23T08:46:50+0100","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h2>Download masterfiles</h2>\n</div>"}]},"apps":[],"jobName":"paragraph_1548174744819_-636674793","id":"20190122-083741_49307927","dateCreated":"2019-01-22T17:32:24+0100","dateStarted":"2019-01-23T08:46:50+0100","dateFinished":"2019-01-23T08:46:50+0100","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:109"},{"text":"fileDownloader(\"http://data.gdeltproject.org/gdeltv2/masterfilelist.txt\", dir + \"masterfilelist.txt\")\nfileDownloader(\"http://data.gdeltproject.org/gdeltv2/masterfilelist-translation.txt\", dir + \"masterfilelist-translation.txt\")","user":"anonymous","dateUpdated":"2019-01-23T08:46:50+0100","config":{"tableHide":false,"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"editorHide":false,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"res8: Any = \"\"\nres9: Any = \"\"\n"}]},"apps":[],"jobName":"paragraph_1548174744819_1902100145","id":"20190110-091832_568521175","dateCreated":"2019-01-22T17:32:24+0100","dateStarted":"2019-01-23T08:46:50+0100","dateFinished":"2019-01-23T08:47:03+0100","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:110"},{"text":"%sh\nls -lrth /home/thibault/Documents/Cours_local/NoSql_INF728/Projet/data |grep masterfilelist","user":"anonymous","dateUpdated":"2019-01-23T08:47:03+0100","config":{"editorSetting":{"language":"sh","editOnDblClick":false,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/sh","fontSize":9,"editorHide":false,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"-rw-r--r-- 1 thibault thibault  42M janv. 23 08:46 masterfilelist.txt\n-rw-r--r-- 1 thibault thibault  45M janv. 23 08:47 masterfilelist-translation.txt\n"}]},"apps":[],"jobName":"paragraph_1548174744820_-1621145897","id":"20181210-111357_801203770","dateCreated":"2019-01-22T17:32:24+0100","dateStarted":"2019-01-23T08:47:03+0100","dateFinished":"2019-01-23T08:47:06+0100","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:111"},{"text":"%md ## Create DataFrame with all url of files to download","user":"anonymous","dateUpdated":"2019-01-23T08:47:06+0100","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h2>Create DataFrame with all url of files to download</h2>\n</div>"}]},"apps":[],"jobName":"paragraph_1548174744820_-84008028","id":"20190122-083804_336474533","dateCreated":"2019-01-22T17:32:24+0100","dateStarted":"2019-01-23T08:47:06+0100","dateFinished":"2019-01-23T08:47:06+0100","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:112"},{"text":"val year_r = \"2018\"\nval month_r = \"0[2-5]\"\nval day_r = \"\"\n\nval DF_masterfile = sqlContext.read.\noption(\"delimiter\",\" \").\noption(\"infer_schema\",\"true\").\ncsv(dir + \"masterfilelist.txt\").\nwithColumnRenamed(\"_c2\",\"url\").filter($\"url\".rlike(\"/\"+year_r+month_r+day_r)).filter(!col(\"url\").contains(\"gkg.csv.zip\")) //Filter gkg\n\nval DF_masterfile_translation = sqlContext.read.\n    option(\"delimiter\",\" \").\n    option(\"infer_schema\",\"true\").\n    csv(dir + \"masterfilelist-translation.txt\").\n    withColumnRenamed(\"_c2\",\"url\").filter($\"url\".rlike(\"/\"+year_r+month_r+day_r)).filter(!col(\"url\").contains(\"gkg.csv.zip\")) //Filter gkg\n    \nprintln(\"Nb row DF_masterfile =\",DF_masterfile.count)\nprintln(\"Nb row DF_masterfile_translation =\",DF_masterfile_translation.count)","user":"anonymous","dateUpdated":"2019-01-23T08:47:06+0100","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"editorHide":false,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"year_r: String = 2018\nmonth_r: String = 0[2-5]\nday_r: String = \"\"\nDF_masterfile: org.apache.spark.sql.Dataset[org.apache.spark.sql.Row] = [_c0: string, _c1: string ... 1 more field]\nDF_masterfile_translation: org.apache.spark.sql.Dataset[org.apache.spark.sql.Row] = [_c0: string, _c1: string ... 1 more field]\n(Nb row DF_masterfile =,21852)\n(Nb row DF_masterfile_translation =,20810)\n"}]},"apps":[],"jobName":"paragraph_1548174744821_1868665594","id":"20190110-100640_1898561075","dateCreated":"2019-01-22T17:32:24+0100","dateStarted":"2019-01-23T08:47:06+0100","dateFinished":"2019-01-23T08:47:20+0100","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:113"},{"text":"DF_masterfile.show(20,false)","user":"anonymous","dateUpdated":"2019-01-23T08:47:20+0100","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"editorHide":false,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+------+--------------------------------+--------------------------------------------------------------------+\n|_c0   |_c1                             |url                                                                 |\n+------+--------------------------------+--------------------------------------------------------------------+\n|319084|b1bc16ac3db012468e072cbc1900d593|http://data.gdeltproject.org/gdeltv2/20180201000000.export.CSV.zip  |\n|287678|334fcde3ca6d31da4645f47a7b6a0568|http://data.gdeltproject.org/gdeltv2/20180201000000.mentions.CSV.zip|\n|319345|8d6fed1392fbc352cc44fa24c7622928|http://data.gdeltproject.org/gdeltv2/20180201001500.export.CSV.zip  |\n|377488|df9eae19ab90ad8d2f5f3d492e5fa821|http://data.gdeltproject.org/gdeltv2/20180201001500.mentions.CSV.zip|\n|241944|950c91e91ee11cfa2da7328e4ebd913a|http://data.gdeltproject.org/gdeltv2/20180201003000.export.CSV.zip  |\n|297569|0670d2b0c9b39f76cd9a3b7c8cf7c5d5|http://data.gdeltproject.org/gdeltv2/20180201003000.mentions.CSV.zip|\n|240902|7d3f5e815765574bfaeed9c7f910a83d|http://data.gdeltproject.org/gdeltv2/20180201004500.export.CSV.zip  |\n|294931|e8128d1abd7a73845618c3b3c0354c64|http://data.gdeltproject.org/gdeltv2/20180201004500.mentions.CSV.zip|\n|185622|39bc9c3e7268367568b472ed67237a05|http://data.gdeltproject.org/gdeltv2/20180201010000.export.CSV.zip  |\n|280275|9b3b016f58431bb70a061871c42ed924|http://data.gdeltproject.org/gdeltv2/20180201010000.mentions.CSV.zip|\n|172419|fe5f27aef26fde3d910b9174b0bd7363|http://data.gdeltproject.org/gdeltv2/20180201011500.export.CSV.zip  |\n|255768|7bc42d0f51e4d6917e9b56ae081f51cf|http://data.gdeltproject.org/gdeltv2/20180201011500.mentions.CSV.zip|\n|199599|d57cf883cba365e1577cda666f925700|http://data.gdeltproject.org/gdeltv2/20180201013000.export.CSV.zip  |\n|288209|5f607fa422eef3f114ebd3c7cdc75055|http://data.gdeltproject.org/gdeltv2/20180201013000.mentions.CSV.zip|\n|156027|41e0e6486cceb94308ecd02a7dc35717|http://data.gdeltproject.org/gdeltv2/20180201014500.export.CSV.zip  |\n|275209|162215b2a35fe325e687b71cc8a33610|http://data.gdeltproject.org/gdeltv2/20180201014500.mentions.CSV.zip|\n|172995|f6ed1be5f4ae037692c5dd2eea16c35d|http://data.gdeltproject.org/gdeltv2/20180201020000.export.CSV.zip  |\n|262064|02bf14f6447201518da25566f1708808|http://data.gdeltproject.org/gdeltv2/20180201020000.mentions.CSV.zip|\n|172864|998ba8ef0f2757af449bd42507982ba5|http://data.gdeltproject.org/gdeltv2/20180201021500.export.CSV.zip  |\n|266375|b963064a56358e6c793e8660a8e0c035|http://data.gdeltproject.org/gdeltv2/20180201021500.mentions.CSV.zip|\n+------+--------------------------------+--------------------------------------------------------------------+\nonly showing top 20 rows\n\n"}]},"apps":[],"jobName":"paragraph_1548174744821_1853041955","id":"20190121-201214_2140259144","dateCreated":"2019-01-22T17:32:24+0100","dateStarted":"2019-01-23T08:47:20+0100","dateFinished":"2019-01-23T08:47:23+0100","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:114"},{"text":"%md ## Download all files from url list","user":"anonymous","dateUpdated":"2019-01-23T08:47:23+0100","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h2>Download all files from url list</h2>\n</div>"}]},"apps":[],"jobName":"paragraph_1548174744822_-581027745","id":"20190122-083644_715320941","dateCreated":"2019-01-22T17:32:24+0100","dateStarted":"2019-01-23T08:47:23+0100","dateFinished":"2019-01-23T08:47:23+0100","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:115"},{"text":"download_all_files(DF_masterfile)\ndownload_all_files(DF_masterfile_translation)","user":"anonymous","dateUpdated":"2019-01-23T14:25:19+0100","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"editorHide":false,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1548174744822_-284382910","id":"20190121-203824_1430444067","dateCreated":"2019-01-22T17:32:24+0100","dateStarted":"2019-01-23T14:25:05+0100","dateFinished":"2019-01-23T14:25:06+0100","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:116"},{"user":"anonymous","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1548185826617_-1977848802","id":"20190122-203706_1450688945","dateCreated":"2019-01-22T20:37:06+0100","status":"READY","progressUpdateIntervalMs":500,"$$hashKey":"object:117"}],"name":"download_local","id":"2E11E2FDX","noteParams":{},"noteForms":{},"angularObjects":{"md:shared_process":[],"sh:shared_process":[],"spark:shared_process":[]},"config":{"isZeppelinNotebookCronEnable":false,"looknfeel":"default","personalizedMode":"false"},"info":{}}