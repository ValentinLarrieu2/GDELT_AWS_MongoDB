{"paragraphs":[{"user":"anonymous","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"editorMode":"ace/mode/markdown","editorHide":false,"tableHide":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1548249125857_-1889495231","id":"20190123-141205_805059608","dateCreated":"2019-01-23T14:12:05+0100","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:1571","text":"%md\n# download files to aws s3","dateUpdated":"2019-01-23T14:24:21+0100","dateFinished":"2019-01-23T14:12:50+0100","dateStarted":"2019-01-23T14:12:50+0100","results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h1>download files to aws s3</h1>\n</div>"}]}},{"text":"%md\n## Import","user":"anonymous","dateUpdated":"2019-01-23T14:13:22+0100","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"editorMode":"ace/mode/markdown","editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1548249181896_922925414","id":"20190123-141301_1126519093","dateCreated":"2019-01-23T14:13:01+0100","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:1725","dateFinished":"2019-01-23T14:13:22+0100","dateStarted":"2019-01-23T14:13:22+0100","results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h2>Import</h2>\n</div>"}]}},{"text":"///////////////////////////////////////////// DL des fichiers dans le bucket\nimport sys.process._\nimport java.net.URL\nimport java.io.File\nimport java.io.File\nimport java.nio.file.{Files, StandardCopyOption}\nimport java.net.HttpURLConnection \nimport org.apache.spark.sql.functions._\nimport com.amazonaws.services.s3.AmazonS3Client\nimport com.amazonaws.auth.BasicAWSCredentials","user":"anonymous","dateUpdated":"2019-01-23T14:14:55+0100","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"editorHide":false,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"ERROR","msg":[{"type":"TEXT","data":"import sys.process._\nimport java.net.URL\nimport java.io.File\nimport java.io.File\nimport java.nio.file.{Files, StandardCopyOption}\nimport java.net.HttpURLConnection\nimport org.apache.spark.sql.functions._\n<console>:34: error: object amazonaws is not a member of package com\n       import com.amazonaws.services.s3.AmazonS3Client\n                  ^\n"}]},"apps":[],"jobName":"paragraph_1548174410221_-569835100","id":"20181209-161931_737140067","dateCreated":"2019-01-22T17:26:50+0100","status":"ERROR","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:492","dateFinished":"2019-01-23T14:15:22+0100","dateStarted":"2019-01-23T14:14:55+0100"},{"user":"anonymous","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"editorMode":"ace/mode/markdown","editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1548249211456_-941260432","id":"20190123-141331_1440470162","dateCreated":"2019-01-23T14:13:31+0100","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:1815","text":"%md \n## GLobal functions and variables","dateUpdated":"2019-01-23T14:13:58+0100","dateFinished":"2019-01-23T14:13:58+0100","dateStarted":"2019-01-23T14:13:58+0100","results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h2>GLobal functions and variables</h2>\n</div>"}]}},{"user":"anonymous","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1548249214376_-1014274180","id":"20190123-141334_382447600","dateCreated":"2019-01-23T14:13:34+0100","status":"READY","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:1887","text":"val dirAws = \"s3a://larrieu-valentin4-telecom-gdelt2018/\"\nval bucketAws = \"larrieu-valentin4-telecom-gdelt2018\"\n\nval AWS_ID = \"**\"\nval AWS_KEY = \"**\"\nval awsClient = new AmazonS3Client(new BasicAWSCredentials(AWS_ID, AWS_KEY))","dateUpdated":"2019-01-23T14:15:08+0100"},{"user":"anonymous","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1548249259607_239131818","id":"20190123-141419_1450688278","dateCreated":"2019-01-23T14:14:19+0100","status":"READY","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:1977","text":"def fileDownloader(urlOfFileToDownload: String, fileName: String) = {\n    val url = new URL(urlOfFileToDownload)\n    val connection = url.openConnection().asInstanceOf[HttpURLConnection]\n    connection.setConnectTimeout(5000)\n    connection.setReadTimeout(5000)\n    connection.connect()\n\n    if (connection.getResponseCode >= 400)\n        println(\"error\")\n    else\n        url #> new File(fileName) !!\n}","dateUpdated":"2019-01-23T14:14:22+0100"},{"user":"anonymous","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"editorMode":"ace/mode/markdown","editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1548249323336_-179004551","id":"20190123-141523_1418700574","dateCreated":"2019-01-23T14:15:23+0100","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:2074","text":"%md ## Download masterfiles","dateUpdated":"2019-01-23T14:15:47+0100","dateFinished":"2019-01-23T14:15:47+0100","dateStarted":"2019-01-23T14:15:47+0100","results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h2>Download masterfiles</h2>\n</div>"}]}},{"text":"fileDownloader(\"http://data.gdeltproject.org/gdeltv2/masterfilelist-translation.txt\", \"/mnt/tmp/masterfilelist-translation.txt\") // save the list file to the Spark Master\nfileDownloader(\"http://data.gdeltproject.org/gdeltv2/masterfilelist.txt\", \"/mnt/tmp/masterfilelist.txt\") // save the list file to the Spark Master","user":"anonymous","dateUpdated":"2019-01-22T17:26:50+0100","config":{"tableHide":false,"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"editorHide":false,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"res10: Any = \"\"\nres11: Any = \"\"\n"}]},"apps":[],"jobName":"paragraph_1548174410223_-940159429","id":"20190110-091832_568521175","dateCreated":"2019-01-22T17:26:50+0100","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:493"},{"text":"\nsc.hadoopConfiguration.set(\"fs.s3a.access.key\", AWS_ID) // mettre votre ID du fichier credentials.csv\nsc.hadoopConfiguration.set(\"fs.s3a.secret.key\", AWS_KEY) // mettre votre secret du fichier credentials.csv\n\nawsClient.putObject(\"larrieu-valentin4-telecom-gdelt2018\", \"masterfilelist-translation.txt\", new File( \"/mnt/tmp/masterfilelist-translation.txt\") )\nawsClient.putObject(\"larrieu-valentin4-telecom-gdelt2018\", \"masterfilelist.txt\", new File( \"/mnt/tmp/masterfilelist.txt\") )","user":"anonymous","dateUpdated":"2019-01-23T14:15:20+0100","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"import com.amazonaws.services.s3.AmazonS3Client\nimport com.amazonaws.auth.BasicAWSCredentials\nAWS_ID: String = AKIAJZPV24CFDZV2FNUA\nAWS_KEY: String = 16XOG3zWhU0kv4aYWKI+/WZ1h/mB1SL/kp9DNYP6\nwarning: there was one deprecation warning; re-run with -deprecation for details\nawsClient: com.amazonaws.services.s3.AmazonS3Client = com.amazonaws.services.s3.AmazonS3Client@443a5a5\nres17: com.amazonaws.services.s3.model.PutObjectResult = com.amazonaws.services.s3.model.PutObjectResult@16fbb909\nres18: com.amazonaws.services.s3.model.PutObjectResult = com.amazonaws.services.s3.model.PutObjectResult@7c80e5b6\n"}]},"apps":[],"jobName":"paragraph_1548174410223_-1059161854","id":"20190122-143229_1119160222","dateCreated":"2019-01-22T17:26:50+0100","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:494"},{"user":"anonymous","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"editorMode":"ace/mode/markdown","editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1548249364353_1671342985","id":"20190123-141604_315720956","dateCreated":"2019-01-23T14:16:04+0100","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:2187","text":"%md ## Create url dataframe and filter by date","dateUpdated":"2019-01-23T14:17:49+0100","dateFinished":"2019-01-23T14:17:49+0100","dateStarted":"2019-01-23T14:17:49+0100","results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h2>Create url dataframe and filter by date</h2>\n</div>"}]}},{"text":"val year_r = \"2018\"\nval month_r = \"\"\nval day_r = \"\"\n\nval DF_masterfile = sqlContext.read.\noption(\"delimiter\",\" \").\noption(\"infer_schema\",\"true\").\ncsv(dirAws + \"masterfilelist.txt\").\nwithColumnRenamed(\"_c2\",\"url\").filter($\"url\".rlike(\"/\"+year_r+month_r+day_r)).filter(!col(\"url\").contains(\"gkg.csv.zip\")) //Filter gkg\n\nval DF_masterfile_translation = sqlContext.read.\n    option(\"delimiter\",\" \").\n    option(\"infer_schema\",\"true\").\n    csv(dirAws + \"masterfilelist-translation.txt\").\n    withColumnRenamed(\"_c2\",\"url\").filter($\"url\".rlike(\"/\"+year_r+month_r+day_r)).filter(!col(\"url\").contains(\"gkg.csv.zip\")) //Filter gkg\n    \nprintln(\"Nb row DF_masterfile =\",DF_masterfile.count)\nprintln(\"Nb row DF_masterfile_translation =\",DF_masterfile_translation.count)","user":"anonymous","dateUpdated":"2019-01-23T14:21:21+0100","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"year_r: String = 2018\nmonth_r: String = \"\"\nday_r: String = \"\"\nDF_masterfile: org.apache.spark.sql.Dataset[org.apache.spark.sql.Row] = [_c0: string, _c1: string ... 1 more field]\nDF_masterfile_translation: org.apache.spark.sql.Dataset[org.apache.spark.sql.Row] = [_c0: string, _c1: string ... 1 more field]\n(Nb row DF_masterfile =,68096)\n(Nb row DF_masterfile_translation =,66440)\n"}]},"apps":[],"jobName":"paragraph_1548174410224_-86561969","id":"20181210-111357_801203770","dateCreated":"2019-01-22T17:26:50+0100","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:495","dateFinished":"2019-01-23T14:21:35+0100","dateStarted":"2019-01-23T14:21:21+0100","runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://137.194.91.24:4040/jobs/job?id=1","http://137.194.91.24:4040/jobs/job?id=2","http://137.194.91.24:4040/jobs/job?id=3","http://137.194.91.24:4040/jobs/job?id=4"],"interpreterSettingId":"spark"}}},{"user":"anonymous","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1548249500337_261284770","id":"20190123-141820_2031764247","dateCreated":"2019-01-23T14:18:20+0100","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:2364","text":"DF_masterfile.show(5, false)","dateUpdated":"2019-01-23T14:21:40+0100","dateFinished":"2019-01-23T14:21:43+0100","dateStarted":"2019-01-23T14:21:41+0100","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+------+--------------------------------+--------------------------------------------------------------------+\n|_c0   |_c1                             |url                                                                 |\n+------+--------------------------------+--------------------------------------------------------------------+\n|137245|7af27516949540f4337694cc0274af84|http://data.gdeltproject.org/gdeltv2/20180101000000.export.CSV.zip  |\n|108185|4b7b5c44784d9e8ae1c18aa94d3df2af|http://data.gdeltproject.org/gdeltv2/20180101000000.mentions.CSV.zip|\n|91437 |dbd933f041dedf095adc9c71cb6df58e|http://data.gdeltproject.org/gdeltv2/20180101001500.export.CSV.zip  |\n|104326|b4b56970b85898b6fefcd020c401ba8d|http://data.gdeltproject.org/gdeltv2/20180101001500.mentions.CSV.zip|\n|91495 |c0ea755c477c1b86ecd06ff18813040e|http://data.gdeltproject.org/gdeltv2/20180101003000.export.CSV.zip  |\n+------+--------------------------------+--------------------------------------------------------------------+\nonly showing top 5 rows\n\n"}]},"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://137.194.91.24:4040/jobs/job?id=5","http://137.194.91.24:4040/jobs/job?id=6"],"interpreterSettingId":"spark"}}},{"text":"DF_masterfile_translation.show(5, false)","user":"anonymous","dateUpdated":"2019-01-22T17:26:50+0100","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-----+--------------------------------+--------------------------------------------------------------------------------+\n|_c0  |_c1                             |url                                                                             |\n+-----+--------------------------------+--------------------------------------------------------------------------------+\n|75981|f193cffcb50694199bef1f45a3480c8c|http://data.gdeltproject.org/gdeltv2/20180101000000.translation.export.CSV.zip  |\n|58751|61426577d41e3659d0cc734c217d88de|http://data.gdeltproject.org/gdeltv2/20180101000000.translation.mentions.CSV.zip|\n|46109|8e21f8105843691a40766dae417c91b7|http://data.gdeltproject.org/gdeltv2/20180101001500.translation.export.CSV.zip  |\n|47436|bb2819bb886c1591bb21dad65651b522|http://data.gdeltproject.org/gdeltv2/20180101001500.translation.mentions.CSV.zip|\n|43973|c5c365e81622b8f9f196105143970dd2|http://data.gdeltproject.org/gdeltv2/20180101003000.translation.export.CSV.zip  |\n+-----+--------------------------------+--------------------------------------------------------------------------------+\nonly showing top 5 rows\n\n"}]},"apps":[],"jobName":"paragraph_1548174410225_-1902623360","id":"20190110-100714_1343939949","dateCreated":"2019-01-22T17:26:50+0100","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:497"},{"text":"val sampleDFM = DF_masterfile.filter(col(\"url\").contains(\"/2018\"))","user":"anonymous","dateUpdated":"2019-01-22T17:26:50+0100","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"sampleDFM: org.apache.spark.sql.Dataset[org.apache.spark.sql.Row] = [_c0: string, _c1: string ... 1 more field]\n"}]},"apps":[],"jobName":"paragraph_1548174410227_153835303","id":"20190122-140302_142968392","dateCreated":"2019-01-22T17:26:50+0100","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:499"},{"text":"val sampleDFMT = DF_masterfile_translation.filter(col(\"url\").contains(\"/2018\"))","user":"anonymous","dateUpdated":"2019-01-22T17:26:50+0100","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"sampleDFMT: org.apache.spark.sql.Dataset[org.apache.spark.sql.Row] = [_c0: string, _c1: string ... 1 more field]\n"}]},"apps":[],"jobName":"paragraph_1548174410227_-639134740","id":"20190122-140259_1470379708","dateCreated":"2019-01-22T17:26:50+0100","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:500"},{"user":"anonymous","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"editorMode":"ace/mode/markdown","editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1548249833232_-1892891720","id":"20190123-142353_2131875189","dateCreated":"2019-01-23T14:23:53+0100","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:2789","text":"%md ## Upload aws s3","dateUpdated":"2019-01-23T14:24:11+0100","dateFinished":"2019-01-23T14:24:11+0100","dateStarted":"2019-01-23T14:24:11+0100","results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h2>Upload aws s3</h2>\n</div>"}]}},{"text":"object AwsClient{\n    val s3 = new AmazonS3Client(new BasicAWSCredentials(AWS_ID, AWS_KEY))\n}\n\nsampleDFM.select(\"url\").repartition(100).foreach( r=> {\n            val URL = r.getAs[String](0)\n            val fileName = r.getAs[String](0).split(\"/\").last\n            val dir = \"/mnt/tmp/\"\n            val localFileName = dir + fileName\n            fileDownloader(URL,  localFileName)\n            val localFile = new File(localFileName)\n            AwsClient.s3.putObject(bucketAws, fileName, localFile )\n            localFile.delete()\n            \n})","user":"anonymous","dateUpdated":"2019-01-23T14:23:12+0100","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"warning: there was one deprecation warning; re-run with -deprecation for details\ndefined object AwsClient\nres43: com.amazonaws.services.s3.model.PutObjectResult = com.amazonaws.services.s3.model.PutObjectResult@5b2aa9b1\n"}]},"apps":[],"jobName":"paragraph_1548174410228_2034673888","id":"20190122-140429_773635779","dateCreated":"2019-01-22T17:26:50+0100","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:501"},{"text":"\n\nobject AwsClient{\n    val s3 = new AmazonS3Client(new BasicAWSCredentials(AWS_ID, AWS_KEY))\n}\n\nsampleDFMT.select(\"url\").repartition(100).foreach( r=> {\n            val URL = r.getAs[String](0)\n            val fileName = r.getAs[String](0).split(\"/\").last\n            val dir = \"/mnt/tmp/\"\n            val localFileName = dir + fileName\n            fileDownloader(URL,  localFileName)\n            val localFile = new File(localFileName)\n            AwsClient.s3.putObject(bucketAws, fileName, localFile )\n            localFile.delete()\n            \n})","user":"anonymous","dateUpdated":"2019-01-23T14:23:18+0100","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"warning: there was one deprecation warning; re-run with -deprecation for details\ndefined object AwsClient\n"}]},"apps":[],"jobName":"paragraph_1548174410228_1388188313","id":"20190122-140449_1574300699","dateCreated":"2019-01-22T17:26:50+0100","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:502"}],"name":"download_aws","id":"2E326WFUP","noteParams":{},"noteForms":{},"angularObjects":{"md:shared_process":[],"sh:shared_process":[],"spark:shared_process":[]},"config":{"isZeppelinNotebookCronEnable":false,"looknfeel":"default","personalizedMode":"false"},"info":{}}